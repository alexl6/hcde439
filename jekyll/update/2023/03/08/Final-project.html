<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Final project | HCDE 439 - Alex</title>
<meta name="generator" content="Jekyll v4.3.1">
<meta property="og:title" content="Final project">
<meta property="og:locale" content="en_US">
<meta name="description" content="Concept The concept of this project is to make a cheap tiny arcade box that plays a clone of the classic arcade game Pong on a 16x2 character LCD display. This is a “spiritual successor(ancestor)” to the first video game I ever developed which was a clone of Breakout written in Processing. The challenge is to build a game with graphics using very limited hardware.">
<meta property="og:description" content="Concept The concept of this project is to make a cheap tiny arcade box that plays a clone of the classic arcade game Pong on a 16x2 character LCD display. This is a “spiritual successor(ancestor)” to the first video game I ever developed which was a clone of Breakout written in Processing. The challenge is to build a game with graphics using very limited hardware.">
<link rel="canonical" href="alexl6.github.io/hcde439/jekyll/update/2023/03/08/Final-project.html">
<meta property="og:url" content="alexl6.github.io/hcde439/jekyll/update/2023/03/08/Final-project.html">
<meta property="og:site_name" content="HCDE 439 - Alex">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-08T00:50:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Final project">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-03-08T00:50:00+00:00","datePublished":"2023-03-08T00:50:00+00:00","description":"Concept The concept of this project is to make a cheap tiny arcade box that plays a clone of the classic arcade game Pong on a 16x2 character LCD display. This is a “spiritual successor(ancestor)” to the first video game I ever developed which was a clone of Breakout written in Processing. The challenge is to build a game with graphics using very limited hardware.","headline":"Final project","mainEntityOfPage":{"@type":"WebPage","@id":"alexl6.github.io/hcde439/jekyll/update/2023/03/08/Final-project.html"},"url":"alexl6.github.io/hcde439/jekyll/update/2023/03/08/Final-project.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/hcde439/assets/main.css">
<link type="application/atom+xml" rel="alternate" href="alexl6.github.io/hcde439/feed.xml" title="HCDE 439 - Alex">
<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/hcde439/">HCDE 439 - Alex</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/hcde439/about/">About</a></div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Final project</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-03-08T00:50:00+00:00" itemprop="datePublished">Mar 8, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="concept">Concept</h2>
<p>The concept of this project is to make a cheap tiny arcade box that plays a clone of the classic arcade game <em>Pong</em> on a 16x2 character LCD display. This is a “spiritual successor(ancestor)” to the first video game I ever developed which was a clone of <em>Breakout</em> written in Processing. The challenge is to build a game with graphics using very limited hardware.</p>

<h2 id="hardware-implementation">Hardware implementation</h2>
<p>The hardware includes two joysticks installed on the side of a character LCD mounted on the top of a cardboard box. The LCD is connected to the microcontroller via 8 digital pins, 5V power, and ground. The pin for its backlight is connected in series to a 220Ω resistor to limit the current through the backlight as suggested by the guide found on <a href="https://docs.arduino.cc/learn/electronics/lcd-displays">Arduino Docs</a>. A potentiometer installed on the breadboard is used to control the contrast of the display. It is hidden in the box to prevent users from accidentally changing its value.</p>

<p>Since the game experience heavily depends on the smoothness of its graphics &amp; responsiveness of controls, I used all 8 digital pins for the LCD in order to get a small increase in LCD write speed &amp; reduction in latency.</p>

<p>The joysticks are powered by the microcontroller and their y-axis pins are connected to the analog input pins on the Arduino board.</p>

<h3 id="circuit-drawing">Circuit drawing</h3>

<p><img src="/hcde439/assets/final_circuit.png" alt="Circuit drawing" width="80%"></p>

<h3 id="circuit-photos">Circuit photos</h3>
<p>View of the circuit before it was mounted inside the box</p>

<p><img src="/hcde439/assets/final_circuit_photo0.png" alt="Circuit before mounting" width="70%"></p>

<p>View of the circuit mounted inside the box</p>

<p><img src="/hcde439/assets/final_circuit_photo1.png" alt="Mounted circuit view (left)" width="49%">
<img src="/hcde439/assets/final_circuit_photo2.png" alt="Mounted circuit view (right)" width="49%"></p>

<p>Final product with mounted joysticks &amp; LCD</p>

<p><img src="/hcde439/assets/final_circuit_photo3.png" alt="Final product with mounted joysticks &amp; LCD" width="70%"></p>

<h2 id="software-implementation">Software implementation</h2>

<h3 id="overview">Overview</h3>
<p>The software implementation is written in Arduino language (C/C++ derivative) and includes the built-in LCD library <code class="language-plaintext highlighter-rouge">LiquidCrystal.h</code>. My firmware is written in C-style code (plus a few C++ features). The main building blocks include game simulation and graphics rendering.</p>

<p>The flowchart below gives an overview of the overall program logic.</p>

<p><img src="/hcde439/assets/final_flowchart.png" alt="Flowchart showing the high-level program logic" width="90%"></p>

<h3 id="graphics">Graphics</h3>
<p>The main challenge of this project is to draw the game graphics on a character LCD which does not allow individual pixels to be addressed directly. The hardware also lacks suppport for sprites and smooth scrolling. My graphics code implementation simulates those effects using 5 custom characters (2 per paddle, 1 for the ball). It mostly abstracts the LCD screen from the game simulation code, making it relatively easy to implement the actual game logic.</p>

<p>Each custom character is represented as a bitmap stored in an 8-byte array. A 1 in the bitmap represents a pixel on the LCD. For example, the following array will create a custom character that looks like a paddle on the right side of the screen.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">byte</span> <span class="n">customChar</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">B00000</span><span class="p">,</span>
  <span class="n">B00001</span><span class="p">,</span>
  <span class="n">B00001</span><span class="p">,</span>
  <span class="n">B00001</span><span class="p">,</span>
  <span class="n">B00001</span><span class="p">,</span>
  <span class="n">B00000</span><span class="p">,</span>
  <span class="n">B00000</span><span class="p">,</span>
  <span class="n">B00000</span>
<span class="p">};</span></code></pre></figure>

<p><img src="/hcde439/assets/final_bitmap_example.png" alt="Bitmap" width="20%"></p>

<p>In my implementation, I used a longer array with more zero bytes at the beginning &amp; the end of this array. Because <code class="language-plaintext highlighter-rouge">lcd.createChar()</code> expects a pointer to a memory location where the next 8 bytes are interpreted as the bitmap for the custom character, I can achieve the effect of moving the paddle up/down by changing where the pointer in pointing within the large byte array. This effectively changes the ‘viewport’ (custom character) to make static paddle appear as if it is moving. Because the padle might span across two vertically stacked characters, two custom characters are used per paddle. These characters share the same large bitmap byte array, but they are looking at it from two different viewports. This task of finding the right location within the byte array bitmap is handled and abstracted by <code class="language-plaintext highlighter-rouge">get_paddle_bitmap()</code>.</p>

<p>The left &amp; right paddles share the same base bitmap. The 1’s are simply shifted to the other side when needed.</p>

<p>The ball character is generated in a similar manner using custom characters. Because the ball can move both vertically and horizontally across the entire screen, its content and the location of that character needs to change over time. Everytime the ball character is updated, the program will clear the charater at its previous location, zero out the entire array, then toggle the correct bit to generate the new bitmap (with some basic bitwise operations). This task is primarily handled by <code class="language-plaintext highlighter-rouge">ball_sprite()</code>.</p>

<p>As the ball gets closer and close to one of the paddles on screen, it will eventually need to share a custom character with one of the paddles. The <code class="language-plaintext highlighter-rouge">render()</code> function will check for that and call <code class="language-plaintext highlighter-rouge">draw_merge_sprite()</code> when needed. The function ‘copies’ the paddle bitmap and merge it with the ball sprite (bitwise OR) before drawing it.</p>

<h3 id="game-simulation">Game simulation</h3>
<p>The game simulation code simlates a <em>Pong</em> game (it is not physically accurate, however). It reads in player input from the joystick, updates the paddles on screen, and moves the ball around the screen. While the graphics code supports letting the ball move in any direction, I decided to limit it to diagnal motion (45 degrees) after testing the actual display’s clarity &amp; responsiveness with different motion patterns. The pong ball will bounce and change direction if it hits the top/bottom wall or a player controlled paddle. The progam delay at the end of <code class="language-plaintext highlighter-rouge">run_session()</code> dictates the game speed.</p>

<p>To improve playability, each paddle is 1 pixel wider in the game logic than it appears on-screen. This is done to compensate the ‘ghosting’ effect of the LCD character display, and it also makes the game feel easier &amp; more forgiving to the players. Because the ball always move in 45 degrees angle, it will also help make the game look more ‘visually correct’.</p>

<p>The game runs at just over 10 fps (frames per second) as determined by the program delay. The main limiting factor is the character LCD as opposed to the software. In my testing, the poor pixel response time makes it very difficult to see the moving ball and paddles if I attempt to run the game at a faster speed. I might be able to improve this by optimizing the ball drawing code to avoid clearing the character previously contained the ball as much as possible, but I think a hardware upgrade to an OLED screen would yield a much more significant improvement to the graphical fidelity &amp; game responsiveness for the end user.</p>

<h2 id="demo-video">Demo video</h2>
<p><video id="media-final_demo.mp4" class="media" style="max-width: 600px;outline: none" controls> <source src="/hcde439/assets/final_demo.mp4"> Your browser doesn't support HTML5 video. Here is a <a href="/hcde439/assets/final_demo.mp4">link to download the video</a> instead.</source></video></p>

<h2 id="full-arduino-source-code">Full Arduino source code</h2>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">// Include external libraries</span>
<span class="cp">#include</span> <span class="cpf">&lt;LiquidCrystal.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;Arduino.h&gt;</span><span class="cp">
</span>
<span class="c1">// Preprocessor macros</span>
<span class="c1">// Defines LCD pins</span>
<span class="cp">#define RS 12
#define ENABLE 11
#define D0 6
#define D1 7
#define D2 8
#define D3 9
#define D4 5
#define D5 4
#define D6 3
#define D7 2
#define PD_L 4
#define PD_R 11
</span>
<span class="c1">// helper enum for handling overlapping ball &amp; paddle</span>
<span class="k">enum</span> <span class="n">DrawOption</span><span class="p">{</span><span class="n">regular</span><span class="p">,</span> <span class="n">upper_left</span><span class="p">,</span> <span class="n">lower_left</span><span class="p">,</span> <span class="n">upper_right</span><span class="p">,</span> <span class="n">lower_right</span><span class="p">};</span>


<span class="c1">// Global variables</span>
<span class="c1">// Initializes LCD object with the predefined pins</span>
<span class="n">LiquidCrystal</span> <span class="nf">lcd</span><span class="p">(</span><span class="n">RS</span><span class="p">,</span> <span class="n">ENABLE</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">D1</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">D3</span><span class="p">,</span> <span class="n">D4</span><span class="p">,</span> <span class="n">D5</span><span class="p">,</span> <span class="n">D6</span><span class="p">,</span> <span class="n">D7</span><span class="p">);</span>

<span class="c1">// Source bitmap for ball sprite</span>
<span class="n">byte</span> <span class="n">ball</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span>
<span class="p">};</span>

<span class="c1">// Source bitmap for paddle sprite</span>
<span class="n">byte</span> <span class="n">paddle_src</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00001</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00001</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00001</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00001</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
  <span class="mi">0</span><span class="n">b00000</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// Struct for holding the two byte pointers pointing to the location to represent</span>
<span class="c1">// paddles</span>
<span class="k">struct</span> <span class="n">paddle_loc</span> <span class="p">{</span>
  <span class="n">byte</span><span class="o">*</span> <span class="n">upper</span><span class="p">;</span>
  <span class="n">byte</span><span class="o">*</span> <span class="n">lower</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Struct for holding a pair of coordinates or (col, row) pair</span>
<span class="k">struct</span> <span class="n">coordinate</span> <span class="p">{</span>
  <span class="kt">int8_t</span> <span class="n">x</span><span class="p">;</span>
  <span class="kt">int8_t</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>


<span class="c1">// Declare helper functions</span>
<span class="c1">// Flips the character bitmap for paddle from left to right or vice versa</span>
<span class="c1">// @param src: source bitmap for paddle</span>
<span class="c1">// @param to_right: whether to flip the paddle to the right or left</span>
<span class="kt">void</span> <span class="nf">flip_paddle_bitmap</span><span class="p">(</span><span class="n">byte</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="n">bool</span> <span class="n">to_right</span><span class="p">);</span>

<span class="c1">// Generate a struct of two pointers pointing to the starting address within the bitmap</span>
<span class="c1">// that will be drawn as a paddle in game</span>
<span class="c1">// @param src: A byte pointer to the source bitmap for paddles</span>
<span class="c1">// @param posn: The paddle's position</span>
<span class="c1">// @return: A paddle_loc struct with 2 pointers to where the upper &amp; lower bitmap should start</span>
<span class="k">struct</span> <span class="n">paddle_loc</span> <span class="nf">get_paddle_bitmap</span><span class="p">(</span><span class="n">byte</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="kt">int8_t</span> <span class="n">posn</span><span class="p">);</span>

<span class="c1">// Handles drawing for overlapping ball &amp; paddle sprite</span>
<span class="c1">// @param b_loc: The character location to draw the merged sprite</span>
<span class="c1">// @param ball: Byte pointer to the btimap for the ball</span>
<span class="c1">// @param paddle: Byte pointer to the bitmap of the paddle</span>
<span class="kt">void</span> <span class="nf">draw_merged_sprite</span><span class="p">(</span><span class="k">struct</span> <span class="n">coordinate</span><span class="o">&amp;</span> <span class="n">b_loc</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">ball</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">paddle</span><span class="p">);</span>

<span class="c1">// Generate the character bitmap for the ball at `posn`, calculates the character location,</span>
<span class="c1">// and clears the previous character location that contained the ball</span>
<span class="c1">// `ret_val` is a return variable</span>
<span class="c1">// @param posn: Current coordinate of the ball</span>
<span class="c1">// @param prev: Previous coordinate of the ball</span>
<span class="c1">// @param ret_val: Return variable, returns the character location containing the ball</span>
<span class="c1">// @return: A byte pointer to the ball sprite</span>
<span class="n">byte</span><span class="o">*</span> <span class="nf">ball_sprite</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">coordinate</span><span class="o">&amp;</span> <span class="n">posn</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">coordinate</span><span class="o">&amp;</span> <span class="n">prev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">coordinate</span><span class="o">&amp;</span> <span class="n">ret_val</span><span class="p">);</span>

<span class="c1">// Draws a custom character at a given character location on screen</span>
<span class="c1">// @param custom_char: The custom character to use (betwwen 0 and 7)</span>
<span class="c1">// @param bitmap: A byte pointer to the bitmap to apply to this character</span>
<span class="c1">// @param col: The column to place the character</span>
<span class="c1">// @param row: The row to place the character</span>
<span class="kt">void</span> <span class="nf">draw_char</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">&amp;</span> <span class="n">custom_char</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">bitmap</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">&amp;</span> <span class="n">col</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">&amp;</span> <span class="n">row</span><span class="p">);</span>

<span class="c1">// Reads joystick input from a given analog pin</span>
<span class="c1">// @param:  Analog pin to read</span>
<span class="c1">// @return: an int16_t between -2 and 2</span>
<span class="kt">int16_t</span> <span class="nf">read_input</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">pin</span><span class="p">);</span>

<span class="c1">// Renders the game graphics based on the ball location/sprite</span>
<span class="c1">// @param b_loc: A coordinate struct representing the ball's character location</span>
<span class="c1">// @param b: A byte pointer pointing to the bitmap for ball sprite</span>
<span class="c1">// @param paddle_src: Pointer to the source bitmap for paddles</span>
<span class="c1">// @param paddle_l: Represents the left paddle's position</span>
<span class="c1">// @param paddle_r: Represents the right paddle's position</span>
<span class="kt">void</span> <span class="nf">render</span><span class="p">(</span><span class="k">struct</span> <span class="n">coordinate</span><span class="o">&amp;</span> <span class="n">b_loc</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">paddle_src</span><span class="p">,</span> <span class="kt">int8_t</span> <span class="n">paddle_l</span><span class="p">,</span> <span class="kt">int8_t</span> <span class="n">paddle_r</span><span class="p">);</span>


<span class="c1">// Main program</span>
<span class="c1">// Setup code, run once</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// set up the LCD's number of columns and rows:</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="c1">// Disable cursor</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">noCursor</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Loop: Repeatly run the game</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">run_session</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// Helper function implementations</span>
<span class="kt">int16_t</span> <span class="nf">read_input</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">pin</span><span class="p">){</span>
  <span class="c1">// Read from the supplied analog pin then subtract 511</span>
  <span class="kt">int16_t</span> <span class="n">reading</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span> <span class="o">-</span> <span class="mi">511</span><span class="p">;</span>
  <span class="c1">// If the joystick is pushed to the extremes, return -2 or 2</span>
  <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">reading</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">495</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">reading</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="o">-</span><span class="mi">2</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">reading</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">){</span>  <span class="c1">// or return -1 or 1</span>
    <span class="k">return</span> <span class="n">reading</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="c1">// Joystick is in deadzone, return 0</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">run_session</span><span class="p">(){</span>
  <span class="c1">// Struct for holding the ball character location</span>
  <span class="k">struct</span> <span class="n">coordinate</span> <span class="n">ball_char_loc</span><span class="p">;</span>

  <span class="c1">// Coordinate structs holding the ball's current and previous position.</span>
  <span class="c1">// coordiantes are absolute to the top left corner of the screen in logical pixels</span>
  <span class="k">struct</span> <span class="n">coordinate</span> <span class="n">curr_posn</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">coordinate</span> <span class="n">prev_posn</span><span class="p">;</span>

  <span class="c1">// Represents the current velocity of the ball in x and y directions</span>
  <span class="kt">int</span> <span class="n">v_x</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">v_y</span><span class="p">;</span>

  <span class="c1">// Pointer to the ball sprite</span>
  <span class="n">byte</span><span class="o">*</span> <span class="n">b</span><span class="p">;</span>

  <span class="c1">// Represents the left &amp; right paddle's position</span>
  <span class="kt">int8_t</span> <span class="n">paddle_l</span><span class="p">;</span>
  <span class="kt">int8_t</span> <span class="n">paddle_r</span><span class="p">;</span>

  <span class="c1">// Initialize ball position</span>
  <span class="n">curr_posn</span> <span class="o">=</span> <span class="p">{</span><span class="mi">45</span><span class="p">,</span> <span class="p">(</span><span class="kt">int8_t</span><span class="p">)(</span><span class="n">millis</span><span class="p">()</span> <span class="o">%</span> <span class="mi">17</span><span class="p">)};</span>
  <span class="n">prev_posn</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>

  <span class="c1">// Generate initial velocity</span>
  <span class="n">v_x</span> <span class="o">=</span> <span class="n">millis</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">v_y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// Initial paddle location</span>
  <span class="n">paddle_l</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">paddle_r</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">bool</span> <span class="n">sensor_clock</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="c1">// Tracks game state</span>
  <span class="n">bool</span> <span class="n">is_alive</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">is_alive</span><span class="p">){</span>
    <span class="c1">// Optional: read from joystick every/every other program cycle</span>
    <span class="k">if</span><span class="p">(</span><span class="n">sensor_clock</span><span class="p">){</span>
      <span class="n">paddle_r</span> <span class="o">+=</span> <span class="n">read_input</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span>
      <span class="n">paddle_l</span> <span class="o">-=</span> <span class="n">read_input</span><span class="p">(</span><span class="n">A1</span><span class="p">);</span>
      <span class="c1">// sensor_clock = false;  // Comment or uncomment this line to half the paddle speed</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">sensor_clock</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Constrain paddles to valid range</span>
    <span class="n">paddle_l</span> <span class="o">=</span> <span class="n">constrain</span><span class="p">(</span><span class="n">paddle_l</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
    <span class="n">paddle_r</span> <span class="o">=</span> <span class="n">constrain</span><span class="p">(</span><span class="n">paddle_r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>

    <span class="c1">// Update current position based on x,y velocities</span>
    <span class="n">curr_posn</span><span class="p">.</span><span class="n">x</span><span class="o">+=</span> <span class="n">v_x</span><span class="p">;</span>
    <span class="n">curr_posn</span><span class="p">.</span><span class="n">y</span><span class="o">+=</span> <span class="n">v_y</span><span class="p">;</span>
    
    <span class="c1">// Bounce off the top/bottom of the screen</span>
    <span class="k">if</span> <span class="err">\</span><span class="p">(</span><span class="n">curr</span><span class="err">\</span><span class="n">_posn</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="err">\</span><span class="o">||</span> <span class="n">curr</span><span class="err">\</span><span class="n">_posn</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">){</span>
      <span class="n">v_y</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Checks if the ball will land on the left paddle</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">curr_posn</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">24</span><span class="p">){</span>
      <span class="c1">// Bounce the ball if it will land on the left paddle</span>
      <span class="k">if</span><span class="p">(</span><span class="n">curr_posn</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">paddle_l</span><span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">curr_posn</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">paddle_l</span> <span class="o">+</span> <span class="mi">5</span><span class="p">){</span>
        <span class="n">v_x</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="c1">// Otherwise end the game</span>
        <span class="n">is_alive</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="p">}</span>      
    <span class="p">}</span>

    <span class="c1">// Checks if the ball will land on the right paddle</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">curr_posn</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">70</span><span class="p">){</span>
      <span class="c1">// Bounce the ball if it will land on the right paddle</span>
      <span class="k">if</span><span class="p">(</span><span class="n">curr_posn</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">paddle_r</span><span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">curr_posn</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">paddle_r</span> <span class="o">+</span> <span class="mi">5</span><span class="p">){</span>
        <span class="n">v_x</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="c1">// Otherwise end the game</span>
        <span class="n">is_alive</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="p">}</span>      
    <span class="p">}</span>

    <span class="c1">// Get the bitmap &amp; character location for the ball</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">ball_sprite</span><span class="p">(</span><span class="n">curr_posn</span><span class="p">,</span> <span class="n">prev_posn</span><span class="p">,</span> <span class="n">ball_char_loc</span><span class="p">);</span>
    
    <span class="c1">// Save this position (x,y)</span>
    <span class="n">prev_posn</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">curr_posn</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">prev_posn</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">curr_posn</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="c1">// Draw graphics based on ball &amp; paddle locations</span>
    <span class="n">render</span><span class="p">(</span><span class="n">ball_char_loc</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">paddle_src</span><span class="p">,</span> <span class="n">paddle_l</span><span class="p">,</span> <span class="n">paddle_r</span><span class="p">);</span>
    
    <span class="c1">// Program delay, controls game speed &amp; latency</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">70</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Add a longer delay when a player wins</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// Flips the character bitmap for paddle from left to right or vice versa</span>
<span class="kt">void</span> <span class="nf">flip_paddle_bitmap</span><span class="p">(</span><span class="n">byte</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="n">bool</span> <span class="n">to_right</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">uint8_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="c1">// Right shift by 4 (to get right paddle)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">to_right</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Left shift by 4 (to get left paddle)</span>
  <span class="k">for</span> <span class="p">(;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="k">struct</span> <span class="n">paddle_loc</span> <span class="nf">get_paddle_bitmap</span><span class="p">(</span><span class="n">byte</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="kt">int8_t</span> <span class="n">posn</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">struct</span> <span class="n">paddle_loc</span> <span class="n">ret_val</span><span class="p">;</span>
  <span class="c1">// Calculate upper character for the paddle</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">posn</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ret_val</span><span class="p">.</span><span class="n">upper</span> <span class="o">=</span> <span class="n">src</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">posn</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">ret_val</span><span class="p">.</span><span class="n">upper</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Calculate lower character for the paddle</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">posn</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ret_val</span><span class="p">.</span><span class="n">lower</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">ret_val</span><span class="p">.</span><span class="n">lower</span> <span class="o">=</span> <span class="n">src</span> <span class="o">+</span> <span class="p">(</span><span class="mi">17</span> <span class="o">-</span> <span class="n">posn</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">ret_val</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">byte</span><span class="o">*</span> <span class="nf">ball_sprite</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">coordinate</span><span class="o">&amp;</span> <span class="n">posn</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">coordinate</span><span class="o">&amp;</span> <span class="n">prev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">coordinate</span><span class="o">&amp;</span> <span class="n">ret_val</span><span class="p">){</span>
  <span class="c1">// Calculate where the pixel should be within the character</span>
  <span class="kt">int8_t</span> <span class="n">relative_x</span> <span class="o">=</span> <span class="n">posn</span><span class="p">.</span><span class="n">x</span> <span class="o">%</span> <span class="mi">6</span><span class="p">;</span>
  <span class="kt">int8_t</span> <span class="n">relative_y</span> <span class="o">=</span> <span class="n">posn</span><span class="p">.</span><span class="n">y</span> <span class="o">%</span> <span class="mi">9</span><span class="p">;</span>
  
  <span class="c1">// Calculate the row &amp; column to place the sprite</span>
  <span class="n">ret_val</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">posn</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">6</span><span class="p">;</span>
  <span class="n">ret_val</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">posn</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="mi">9</span><span class="p">;</span>
  <span class="o">*</span><span class="p">((</span><span class="kt">uint64_t</span><span class="o">*</span><span class="p">)</span><span class="n">ball</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// Reset ball sprite to empty</span>

  <span class="c1">// Ball is on the boundary between characters</span>
  <span class="c1">// Clear previous character and return</span>
  <span class="k">if</span> <span class="err">\</span><span class="p">(</span><span class="n">relative</span><span class="err">\</span><span class="n">_x</span> <span class="o">==</span> <span class="mi">5</span> <span class="err">\</span><span class="o">||</span> <span class="n">relative</span><span class="err">\</span><span class="n">_y</span> <span class="o">==</span> <span class="mi">8</span><span class="p">){</span>
    <span class="c1">// Move cursor and directly write an empty charcter</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">prev</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="n">prev</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="mi">9</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">byte</span><span class="p">(</span><span class="mi">32</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">ball</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Clear the previous character if the ball is now on a different character</span>
  <span class="k">if</span> <span class="err">\</span><span class="p">(</span><span class="n">posn</span><span class="p">.</span><span class="n">x</span> <span class="o">!=</span> <span class="n">prev</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="mi">6</span> <span class="err">\</span><span class="o">||</span> <span class="n">posn</span><span class="p">.</span><span class="n">y</span> <span class="o">!=</span> <span class="n">prev</span><span class="p">.</span><span class="n">y</span><span class="o">/</span><span class="mi">9</span><span class="p">){</span>
    <span class="c1">// Move cursor and directly write an empty charcter</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">prev</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="n">prev</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="mi">9</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">byte</span><span class="p">(</span><span class="mi">32</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">// Create the new ball sprite</span>
  <span class="n">ball</span><span class="p">[</span><span class="n">relative_y</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="n">relative_x</span><span class="p">);</span> <span class="c1">// Shift the ball pixel</span>
  <span class="k">return</span> <span class="n">ball</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">draw_merged_sprite</span><span class="p">(</span><span class="k">struct</span> <span class="n">coordinate</span><span class="o">&amp;</span> <span class="n">b_loc</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">ball</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">paddle</span><span class="p">){</span>
  <span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="p">(</span><span class="n">uint64</span><span class="err">\</span><span class="n">_t</span><span class="err">\</span><span class="o">*</span><span class="p">)</span><span class="n">ball</span> <span class="o">|=</span> <span class="err">\</span><span class="o">*</span><span class="err">\</span><span class="p">(</span><span class="n">uint64</span><span class="err">\</span><span class="n">_t</span><span class="err">\</span><span class="o">*</span><span class="p">)</span><span class="n">paddle</span><span class="p">;</span>
  <span class="n">draw_char</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">ball</span><span class="p">,</span> <span class="n">b_loc</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">b_loc</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">draw_char</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">&amp;</span> <span class="n">custom_char</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">bitmap</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">&amp;</span> <span class="n">col</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">&amp;</span> <span class="n">row</span><span class="p">){</span>
  <span class="c1">// Create custome character from bitmap</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">createChar</span><span class="p">(</span><span class="n">custom_char</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">);</span>
  <span class="c1">// Move cursor</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span>
  <span class="c1">// Write custome character</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">byte</span><span class="p">(</span><span class="n">custom_char</span><span class="p">));</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">render</span><span class="p">(</span><span class="k">struct</span> <span class="n">coordinate</span><span class="o">&amp;</span> <span class="n">b_loc</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">paddle</span><span class="p">,</span> <span class="kt">int8_t</span> <span class="n">paddle_l</span><span class="p">,</span> <span class="kt">int8_t</span> <span class="n">paddle_r</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Determine the necessary draw options</span>
  <span class="n">DrawOption</span> <span class="n">opt</span> <span class="o">=</span> <span class="n">regular</span><span class="p">;</span> <span class="c1">// Assume ball does not overlap with any paddles</span>
  
  <span class="c1">// Optionally merge with left/right paddle</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">b_loc</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">PD_L</span><span class="p">){</span> <span class="c1">// left</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_loc</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="n">upper_left</span> <span class="o">:</span> <span class="n">lower_left</span><span class="p">;</span>   <span class="c1">// overlap with upper or lower half?</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">b_loc</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">PD_R</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// right</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_loc</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="n">upper_right</span> <span class="o">:</span> <span class="n">lower_right</span><span class="p">;</span> <span class="c1">// overlap with upper or lower half?</span>
  <span class="p">}</span>
  
  <span class="c1">// Get bitmap for right paddles</span>
  <span class="k">struct</span> <span class="n">paddle_loc</span> <span class="n">pd</span> <span class="o">=</span> <span class="n">get_paddle_bitmap</span><span class="p">(</span><span class="n">paddle</span><span class="p">,</span> <span class="n">paddle_r</span><span class="p">);</span>

  <span class="c1">// Draw the upper half right paddle</span>
  <span class="k">if</span><span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="n">upper_right</span><span class="p">){</span>
    <span class="c1">// Merge upper half of right paddle with the ball</span>
    <span class="n">draw_merged_sprite</span><span class="p">(</span><span class="n">b_loc</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">upper</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// draw directly</span>
    <span class="n">draw_char</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">upper</span><span class="p">,</span> <span class="n">PD_R</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Draws the lower half of right paddle</span>
  <span class="k">if</span><span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="n">lower_right</span><span class="p">){</span>
    <span class="c1">// Merge lower half of right paddle with the ball</span>
    <span class="n">draw_merged_sprite</span><span class="p">(</span><span class="n">b_loc</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">lower</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// draw directly</span>
    <span class="n">draw_char</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">PD_R</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">//  Get right paddle bitmap &amp; flip the 1 bits to left side</span>
  <span class="n">pd</span> <span class="o">=</span> <span class="n">get_paddle_bitmap</span><span class="p">(</span><span class="n">paddle</span><span class="p">,</span> <span class="n">paddle_l</span><span class="p">);</span>
  <span class="n">flip_paddle_bitmap</span><span class="p">(</span><span class="n">paddle</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

  <span class="c1">// Draws the upper half of left paddle</span>
  <span class="k">if</span><span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="n">upper_left</span><span class="p">){</span>
    <span class="c1">// Merge upper half of left paddle with the ball</span>
    <span class="n">draw_merged_sprite</span><span class="p">(</span><span class="n">b_loc</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">upper</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
    <span class="c1">// draw directly</span>
    <span class="n">draw_char</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">upper</span><span class="p">,</span> <span class="n">PD_L</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Draws the lower half of left paddle</span>
  <span class="k">if</span><span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="n">lower_left</span><span class="p">){</span>
    <span class="c1">// Merge lower half of right paddle with the ball</span>
    <span class="n">draw_merged_sprite</span><span class="p">(</span><span class="n">b_loc</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">lower</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// draw directly</span>
    <span class="n">draw_char</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">PD_L</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Flips the paddle bitmap back to its original position</span>
  <span class="n">flip_paddle_bitmap</span><span class="p">(</span><span class="n">paddle</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

  <span class="c1">// Draws the ball separately if it doesn't overlap with anything</span>
  <span class="k">if</span><span class="p">(</span><span class="n">opt</span> <span class="o">==</span> <span class="n">regular</span><span class="p">){</span>
    <span class="n">draw_char</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">b_loc</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">b_loc</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>


  </div>
<a class="u-url" href="/hcde439/jekyll/update/2023/03/08/Final-project.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/hcde439/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">HCDE 439 - Alex</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">HCDE 439 - Alex</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/alexl6"><svg class="svg-icon"><use xlink:href="/hcde439/assets/minima-social-icons.svg#github"></use></svg> <span class="username">alexl6</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Alex's site for HCDE 439: Physical Computing projects (Winter 2023). Site generated by Jekyll.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
